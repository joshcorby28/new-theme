<!doctype html>
<html lang="{{ request.locale.iso_code }}">
  <head>
    <script src="https://js.squarecdn.com/square-marketplace.js" async></script>
    {% # Inlined CSS Variables %}
    {% render 'css-variables' %}

    {% # Load and preload the critical CSS %}
    {{ 'critical.css' | asset_url | stylesheet_tag: preload: true }}
    {{ 'fract.css' | asset_url | stylesheet_tag: preload: true }}

    {% # Preload and load fract.js %}
    <link rel="preload" as="script" href="{{ 'fract.js' | asset_url }}">
    <script src="{{ 'fract.js' | asset_url }}" defer></script>


    {% # Social, title, etc. %}
    {% render 'meta-tags' %}
    <link rel="icon" href="https://cdn.shopify.com/s/files/1/0842/1084/3976/files/New_Project_19.png?v=1762095815" type="image/png">

    {{ content_for_header }}
  </head>

  <body id="hidden-theme">
    {% render 'cart-drawer' %}
    {% # Grunge Overlay Effect %}
       {% if settings['grunge-effect'] %} <canvas id="grain-canvas"></canvas>{% endif %}
    {% if settings['grunge-effect'] %}
      <script>
        const canvas = document.getElementById('grain-canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }

        function drawNoise() {
          const imageData = ctx.createImageData(canvas.width, canvas.height);
          const buffer32 = new Uint32Array(imageData.data.buffer);
          for (let i = 0; i < buffer32.length; i++) {
            buffer32[i] = (Math.floor(Math.random() * 255) << 24) | 0xffffff;
          }
          ctx.putImageData(imageData, 0, 0);
        }

        function loop() {
          drawNoise();
          setTimeout(loop, 50);
        }

        window.addEventListener('resize', resize);
        resize();
        loop();
      </script>
      
      <style>
        #grain-canvas {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          pointer-events: none;
          opacity: {{settings.grain-opacity}};
          z-index: 9999;
        }
      </style>
    {% endif %}
    {% # Grunge Overlay Effect %}

    <!-- First Drop Discount Popup -->
<style>
  /* Overlay */
  #first-drop-popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.4);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  /* Popup container with frosted glass */
  #first-drop-popup {
    border-radius: 4px;
    width: 95%;
    max-width: 400px;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
    padding: 30px 20px;
    text-align: center;
    color: #111;
    font-family: sans-serif;
    position: relative;
  }

  #first-drop-popup h2 {
    margin-bottom: 15px;
    font-size: 22px;
  }

  #first-drop-popup p {
    margin-bottom: 25px;
    font-size: 16px;
  }

  #first-drop-popup .discount-code {
    font-weight: bold;
    font-size: 14px;
    background: #f5f5f5;
    padding: 10px 15px;
    display: inline-block;
    margin-bottom: 20px;
  }

  #first-drop-popup button {
    background: #111;
    color: white;
    padding: 12px 25px;
    border: none;
    cursor: pointer;
    font-size: 12px;
  }

  #first-drop-popup .close-popup {
    position: absolute;
    top: 12px;
    right: 15px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
  }
</style>

    {% sections 'header-group' %}

    {% # Global %}
      <style>
        {% if settings.uppercase_headings_links %}
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          a,
          summary,
          .mobile-menu-toggle
          {
            text-transform: uppercase;
            letter-spacing: -1px;
          }
        {% endif %}
      
        {% if settings.capitalize_spans %}
          span {
            text-transform: uppercase;
            letter-spacing: -1px;
          }
        {% endif %}

        /* Buttons */
        .fract-primary {
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 12px 24px;
          text-decoration: none;
          font-size: 13px;
          transition: background-color 0.3s, color 0.3s;
          cursor: pointer;
          border: none;
          white-space: nowrap;
          height: 50px;
          width: fit-content;
          background: {{ settings.primary_button-bg }};
          color: {{ settings.primary_button-text }};
          letter-spacing: 0;
          text-transform: uppercase;
        }
       
        .fract-secondary {
          padding: 12px 24px;
          font-size: 13px;
          cursor: pointer;
          border: none;
          white-space: nowrap;
          font-size: 13px;
          height: 50px;
          text-decoration:none;
          background: #fff;
          border:1px solid {{ settings.second_button-border }};
          width:100%;
          color: {{ settings.second_button-text }};
          letter-spacing: 0;
          text-transform: uppercase;
          display:flex;
          width: fit-content;
          align-items: center;
          justify-content: center;
        }

        .underlined-link {
          font-size:13px;
          color: {{ settings.second_button-text }};
        }

          .button-skew:hover {
            transition: transform 0.4s ease-in-out;
            transform: skew(3deg, 3deg);
          }
        
          .button-skew:hover {
            transition: transform 0.4s ease-in-out;
          }

          :root {
            --text-color: {{ settings.text_color }};
          }


      </style>

    {{ content_for_layout }}
  {% if template == 'index' %}
    <style>
      header {
      position: absolute;
      z-index: 9;
      width: 100%;
        background:transparent;
      top:60px;
      }

      :root {
        --page-width: {{ settings.page_width | divided_by: 10 }}rem;
      }

      .header__logo-link img {
          filter: invert(1);}

          .desktop-menu a,  .header__icons sup {
          color:white;}
          .header__icons path, circle {
          stroke:white;}
    </style>
  {% endif %}
<!-- Discount Popup Start -->
<div id="discount-popup" class="discount-popup">
  <div class="popup-content">
    <button class="close-popup" aria-label="Close">&times;</button>
    <h2>GET 10% OFF FIRST DROP</h2>
    <p>USE CODE <strong>FIRSTDROP10</strong></p>
  </div>
</div>

<style>
.discount-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.4);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.popup-content {
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
  border-radius: 4px;
  padding: 2rem;
  text-align: center;
  max-width: 520px;
  position: relative;
}

.popup-content h2 {
  font-size: 1.4rem;
  margin-bottom: 0.5rem;
  text-transform: uppercase;
}

.popup-content p {
  font-size: 1rem;
}

.close-popup {
  position: absolute;
  top: 8px;
  right: 10px;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #000;
  line-height: 1;
}
</style>

<script>
// Function to hide the Klaviyo link
function hideKlaviyoLink() {
  const klaviyoLink = document.querySelector('a[aria-label="Created with Klaviyo - opens in a new tab"]');
  if (klaviyoLink) {
    klaviyoLink.style.display = 'none';
    return true;
  }
  return false;
}

// Poll until the link exists
const interval = setInterval(() => {
  // Only try hiding if the parent container exists
  const parent = document.querySelector('.needsclick.kl-private-reset-css-Xuajs1');
  if (parent && hideKlaviyoLink()) {
    clearInterval(interval); // Stop polling once hidden
  }
}, 100); // check every 100ms

</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const DISCOUNT_CODE = 'FIRSTDROP10';

  async function applyDiscount() {
    try {
      const cart = await fetch('/cart.js').then(r => r.json());

      // Prevent re-applying
      if (cart.attributes && cart.attributes._discountApplied === DISCOUNT_CODE) return;

      // Mark attribute
      await fetch('/cart/update.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          attributes: { _discountApplied: DISCOUNT_CODE }
        })
      });

      // Apply discount silently (no redirect)
      await fetch(`/discount/${DISCOUNT_CODE}?redirect=/cart`, { method: 'GET' });

    } catch (err) {
      console.error('Auto-discount error:', err);
    }
  }

  // Always run once on load
  applyDiscount();

  // ðŸ”¥ Universal AJAX listeners used by all modern themes
  const events = [
    'cart:updated',
    'cart:update',
    'cart:change',
    'ajaxProduct:added',
    'product:added',
    'addToCart',
    'added.ajaxCart',
    'cart.requestComplete' // used by many apps
  ];

  events.forEach(ev => document.addEventListener(ev, applyDiscount));

  // ðŸ”¥ MutationObserver fallback for themes with zero events
  const cartObserver = new MutationObserver(() => applyDiscount());
  cartObserver.observe(document.body, { childList: true, subtree: true });
});
</script>


    {% sections 'footer-group' %}
  </body>
</html>
