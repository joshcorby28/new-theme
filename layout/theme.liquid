<!doctype html>
<html lang="{{ request.locale.iso_code }}">
  <head>
    {% # Inlined CSS Variables %}
    {% render 'css-variables' %}

    {% # Load and preload the critical CSS %}
    {{ 'critical.css' | asset_url | stylesheet_tag: preload: true }}

    {% # Social, title, etc. %}
    {% render 'meta-tags' %}

    {{ content_for_header }}
  </head>

  <body id="hidden-theme">
    {% # Grunge Overlay Effect %}
    <canvas id="grain-canvas"></canvas>
    {% if settings['grunge-effect'] %}
      <script>
        const canvas = document.getElementById('grain-canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }

        function drawNoise() {
          const imageData = ctx.createImageData(canvas.width, canvas.height);
          const buffer32 = new Uint32Array(imageData.data.buffer);
          for (let i = 0; i < buffer32.length; i++) {
            buffer32[i] = (Math.floor(Math.random() * 255) << 24) | 0xffffff;
          }
          ctx.putImageData(imageData, 0, 0);
        }

        function loop() {
          drawNoise();
          setTimeout(loop, 50);
        }

        window.addEventListener('resize', resize);
        resize();
        loop();
      </script>

      <style>
        #grain-canvas {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          pointer-events: none;
          opacity: {{settings.grain-opacity}};
          z-index: 9999;
        }
      </style>
    {% endif %}
    {% # Grunge Overlay Effect %}

    <div
      id="preloader"
      style="position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:9999;display:flex;align-items:center;justify-content:center;"
    >
      <div class="loader">Loading...</div>
    </div>

    <style>
      #preloader .loader {
        font-size: 1.5rem;
        font-weight: bold;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
    </style>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
          var preloader = document.getElementById("preloader");
          if (preloader) {
            preloader.style.transition = "opacity 0.5s ease";
            preloader.style.opacity = 0;
            setTimeout(function () {
              preloader.style.display = "none";
            }, 500);
          }
        }, 5000); // 5 seconds
      });
    </script>



    {% sections 'header-group' %}

    {% # Index Page %}
    {% if template == 'index' %}
      <style>
        footer {
          display: none;
        }
      </style>
    {% endif %}

    {% # Global %}
    {% if settings['text-uppercase'] %}
      <style>
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        a,
        span {
          text-transform: uppercase;
        }
      </style>
    {% endif %}

    {{ content_for_layout }}

    <style>
      .shopify-section-group-header-group {
      position: absolute;
      z-index: 9;
      width: 100%;
      }

      :root {
        --page-width: {{ settings.page_width | divided_by: 10 }}rem;
      }
    </style>

    {% render 'audio-player' %}

    {% sections 'footer-group' %}
  </body>
</html>
